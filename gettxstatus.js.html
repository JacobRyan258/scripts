<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>gettxstatus.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-AutoMiner.html">AutoMiner</a><ul class='methods'><li data-type='method'><a href="module-AutoMiner.html#~autoMine">autoMine</a></li><li data-type='method'><a href="module-AutoMiner.html#~promptFeeStrategy">promptFeeStrategy</a></li><li data-type='method'><a href="module-AutoMiner.html#~promptMiningStrategy">promptMiningStrategy</a></li><li data-type='method'><a href="module-AutoMiner.html#~promptUserConfig">promptUserConfig</a></li></ul></li><li><a href="module-AutoMiningClaimer.html">AutoMiningClaimer</a><ul class='methods'><li data-type='method'><a href="module-AutoMiningClaimer.html#~autoMiningClaimer">autoMiningClaimer</a></li><li data-type='method'><a href="module-AutoMiningClaimer.html#~promptUserConfig">promptUserConfig</a></li></ul></li><li><a href="module-GetNetworkStatus.html">GetNetworkStatus</a><ul class='methods'><li data-type='method'><a href="module-GetNetworkStatus.html#~getNetworkStatus">getNetworkStatus</a></li></ul></li><li><a href="module-GetStackingInfo.html">GetStackingInfo</a><ul class='methods'><li data-type='method'><a href="module-GetStackingInfo.html#~getStackingInfo">getStackingInfo</a></li><li data-type='method'><a href="module-GetStackingInfo.html#~promptUserConfig">promptUserConfig</a></li></ul></li><li><a href="module-GetTxStatus.html">GetTxStatus</a><ul class='methods'><li data-type='method'><a href="module-GetTxStatus.html#~getTxStatus">getTxStatus</a></li><li data-type='method'><a href="module-GetTxStatus.html#~promptUserConfig">promptUserConfig</a></li></ul></li><li><a href="module-Utilities.html">Utilities</a><ul class='methods'><li data-type='method'><a href="module-Utilities.html#~cancelPrompt">cancelPrompt</a></li><li data-type='method'><a href="module-Utilities.html#~canClaimMiningReward">canClaimMiningReward</a></li><li data-type='method'><a href="module-Utilities.html#~exitWithError">exitWithError</a></li><li data-type='method'><a href="module-Utilities.html#~exitWithSuccess">exitWithSuccess</a></li><li data-type='method'><a href="module-Utilities.html#~getAccountTxs">getAccountTxs</a></li><li data-type='method'><a href="module-Utilities.html#~getBlockAvg">getBlockAvg</a></li><li data-type='method'><a href="module-Utilities.html#~getBlockCommit">getBlockCommit</a></li><li data-type='method'><a href="module-Utilities.html#~getBlockHeight">getBlockHeight</a></li><li data-type='method'><a href="module-Utilities.html#~getMiningStatsAtBlock">getMiningStatsAtBlock</a></li><li data-type='method'><a href="module-Utilities.html#~getNonce">getNonce</a></li><li data-type='method'><a href="module-Utilities.html#~getOptimalFee">getOptimalFee</a></li><li data-type='method'><a href="module-Utilities.html#~getRewardCycle">getRewardCycle</a></li><li data-type='method'><a href="module-Utilities.html#~getStackerAtCycleOrDefault">getStackerAtCycleOrDefault</a></li><li data-type='method'><a href="module-Utilities.html#~getStackingReward">getStackingReward</a></li><li data-type='method'><a href="module-Utilities.html#~getStxBalance">getStxBalance</a></li><li data-type='method'><a href="module-Utilities.html#~getTotalMempoolTx">getTotalMempoolTx</a></li><li data-type='method'><a href="module-Utilities.html#~getUserId">getUserId</a></li><li data-type='method'><a href="module-Utilities.html#~printDivider">printDivider</a></li><li data-type='method'><a href="module-Utilities.html#~printTimeStamp">printTimeStamp</a></li><li data-type='method'><a href="module-Utilities.html#~processTx">processTx</a></li><li data-type='method'><a href="module-Utilities.html#~safeFetch">safeFetch</a></li><li data-type='method'><a href="module-Utilities.html#~timer">timer</a></li><li data-type='method'><a href="module-Utilities.html#~waitUntilBlock">waitUntilBlock</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">gettxstatus.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import console from "console";
import prompts from "prompts";
import {
  cancelPrompt,
  err,
  exitWithError,
  exitWithSuccess,
  printDivider,
  printTimeStamp,
  safeFetch,
  STACKS_NETWORK,
  timer,
  title,
  USTX,
  warn,
} from "./utils.js";

/** @module GetTxStatus */

/**
 * @async
 * @function promptUserConfig
 * @description Prompts the user for configuration options at the start of the script
 * @returns {Object[]} An object that contains properties for each question name and related answers as a values
 */
async function promptUserConfig() {
  const questions = [
    {
      type: "text",
      name: "txid",
      message: "TXID to check?",
      validate: (value) => (value === "" ? "TXID is required" : true),
    },
    {
      type: "number",
      name: "interval",
      message: "Interval (minutes) to check?",
      validate: (value) =>
        value > 14 ? true : "Interval must be 15min or greater",
    },
  ];
  const userConfig = await prompts(questions, { onCancel: cancelPrompt });
  return userConfig;
}

/**
 * @async
 * @function getTxStatus
 * @param {Object[]} userConfig An object that contains properties for each question name and related answers as a values
 * @description Gets the status for a provided TXID on a set interval
 */
async function getTxStatus(userConfig) {
  let count = 0;
  const countLimit = 100;
  const url = `${STACKS_NETWORK.coreApiUrl}/extended/v1/tx/${userConfig.txid}`;
  const interval = userConfig.interval * 60 * 1000;

  do {
    const txResult = await safeFetch(url);
    printDivider();
    console.log(
      title(
        `TX STATUS: ${
          txResult.hasOwnProperty("tx_status")
            ? txResult.tx_status.toUpperCase()
            : "PENDING"
        }`
      )
    );
    printDivider();
    printTimeStamp();

    // exit if success or fail
    if (txResult.tx_status === "success") {
      exitWithSuccess(
        `tx succeeded, exiting...\ntxid: ${txResult.tx_id}\nhttps://explorer.stacks.co/txid/${txResult.tx_id}`
      );
    }
    if (txResult.tx_status === "abort_by_post_condition") {
      exitWithError(
        `tx failed, exiting...\ntxid: ${txResult.tx_id}\nhttps://explorer.stacks.co/txid/${txResult.tx_id}`
      );
    }

    // log tx details
    console.log(
      `account: ${txResult.sender_address.slice(
        0,
        5
      )}...${txResult.sender_address.slice(txResult.sender_address.length - 5)}`
    );
    console.log(`nonce: ${txResult.nonce}`);
    console.log(`fee: ${(txResult.fee_rate / USTX).toFixed(6)} STX`);
    const submitDate = new Date(txResult.receipt_time_iso);
    const submitted = submitDate.toLocaleString().replace(/,/g, "");
    console.log(`submitted: ${submitted}`);
    // calculate time passed since submission in hours
    const currentDate = new Date();
    const timePassed = (
      (currentDate.getTime() - submitDate.getTime()) /
      1000 /
      60 /
      60
    ).toFixed(2);
    // add color if pending for a long time
    if (parseInt(timePassed) > 4) {
      console.log(err(`timePassed: ${timePassed} hours`));
    } else if (parseInt(timePassed) > 2) {
      console.log(warn(`timePassed: ${timePassed} hours`));
    } else {
      console.log(`timePassed: ${timePassed} hours`);
    }
    // print link to tx on explorer
    console.log(`https://explorer.stacks.co/txid/${txResult.tx_id}`);

    // pause before checking again
    await timer(interval);
    count++;
  } while (count &lt; countLimit);
}

promptUserConfig().then((answers) => getTxStatus(answers));
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Wed Jan 19 2022 19:46:40 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
